## Day 10: Linux Bash Scripts

The production support team of xFusionCorp Industries is working on developing some bash scripts to automate different day to day tasks. One is to create a bash script for taking websites backup. They have a static website running on App Server 3 in Stratos Datacenter, and they need to create a bash script named official_backup.sh which should accomplish the following tasks. (Also remember to place the script under /scripts directory on App Server 3).

a. Create a zip archive named xfusioncorp_official.zip of /var/www/html/official directory.

b. Save the archive in /backup/ on App Server 3. This is a temporary storage, as backups from this location will be clean on weekly basis. Therefore, we also need to save this backup archive on Nautilus Backup Server.

c. Copy the created archive to Nautilus Backup Server server in /backup/ location.

d. Please make sure script won't ask for password while copying the archive file. Additionally, the respective server user (for example, tony in case of App Server 1) must be able to run it.

### Replace official word everywhere with beta.

**What I Did**

------------------------------------------------------------------------------
1. ssh steve@172.16.238.11


2. ls /scripts/
- This command lists the contents of the /scripts/ directory also to verify the directory already exits.



3. sudo vi /scripts/beta_backup.sh

- This command opens a file named beta_backup.sh in the /scripts directory using the vi text editor with sudo (superuser) privileges.

```
bash
#!/bin/bash

# Create a zip archive of /var/www/html/beta directory
zip -r /backup/xfusioncorp_beta.zip /var/www/html/beta

# Copy the created archive to Nautilus Backup Server in /backup/ location

scp /backup/xfusioncorp_beta.zip <username>@<Nautilus_Backup_Server_IP>:/backup/

```
**Make sure to setup passwordless SSH login for the respective server user before executing the beta_backup.sh file .**

4. ssh-keygen
    
- This command generates a public/private key pair for SSH authentication. It's used to setup passwordless SSH login between servers.


5. ssh-copy-id clint@172.16.238.16

- This command copies the public SSH key generated by ssh-keygen to the user clint on the server with IP 172.16.238.16. This sets up passwordless SSH login for user clint on that server.

6. ssh clint@172.16.238.16 # Verify if connection is established or not without password

- This command initiates an SSH connection to the server with IP 172.16.238.16 as user clint. If passwordless SSH is setup correctly, it logs in without asking for a password.

7. sudo chmod +x /scripts/beta_backup.sh

- This command makes the beta_backup.sh script in /scripts executable. The +x flag adds execute permissions.

8. sudo /scripts/beta_backup.sh

- This command runs the beta_backup.sh script in /scripts with sudo (superuser) privileges.

8. ssh clint@172.16.238.16 ls -la /backup/

- This command runs ls -la /backup/ on the server with IP 172.16.238.16 as user clint via SSH. It lists the contents of the /backup/ directory in a detailed format to veryfy if the zip file is copied to the /backup/ directory.
------------------------------------------------------------------------------

**MetaAI Solution:**

### Task Breakdown:

The task is to create a bash script named official_backup.sh for the production support team of xFusionCorp Industries. The script needs to accomplish the following tasks for a static website running on App Server 3 in Stratos Datacenter:

1. Create a zip archive: Create a zip archive named xfusioncorp_official.zip of the /var/www/html/official directory.
2. Save in temporary storage: Save the archive in /backup/ on App Server 3 (temporary storage, as backups from this location will be cleaned on a weekly basis).
3. Copy to Nautilus Backup Server: Copy the created archive to Nautilus Backup Server in the /backup/ location.
4. Passwordless copy: Ensure the script won't ask for a password while copying the archive file. The respective server user must be able to run the script.

Step-by-Step Explanation in Detail:

*Step 1: Create a zip archive of /var/www/html/official*
- The command zip -r /backup/xfusioncorp_official.zip /var/www/html/official is used.
- zip: The command to create a zip archive.
- -r: Option to recurse into directories, including all files and subdirectories.
- /backup/xfusioncorp_official.zip: The path and name of the output zip file.
- /var/www/html/official: The directory to be archived.

*Step 2: Save the archive in /backup/ on App Server 3*
- As part of the zip command in Step 1, the archive is saved in /backup/.

Step 3: Copy the archive to Nautilus Backup Server
- The command scp /backup/xfusioncorp_official.zip <username>@<Nautilus_Backup_Server_IP>:/backup/ is used.
- scp: Secure copy command to copy files between hosts.
- /backup/xfusioncorp_official.zip: The local file to be copied.
- <username>@<Nautilus_Backup_Server_IP>:/backup/: Destination on Nautilus Backup Server.
- Replace <username> with the username on Nautilus Backup Server and <Nautilus_Backup_Server_IP> with the server's IP.

Step 4: Ensure passwordless copy
- To avoid password prompts during scp, setup passwordless SSH login between App Server 3 and Nautilus Backup Server.
- Setup passwordless SSH:
    1. On App Server 3, run ssh-keygen -t rsa to generate an SSH key pair for the user. Leave the passphrase empty.
    2. Copy the public key to Nautilus Backup Server using ssh-copy-id <username>@<Nautilus_Backup_Server_IP>.

Script Placement and Permissions:
- Place the official_backup.sh script in the /scripts directory on App Server 3.
- Make the script executable using sudo chmod +x /scripts/official_backup.sh.

Do you need further clarification on any of these steps or help with implementing the script?

----------------------------------------------------
Here's how you can create the official_backup.sh script to accomplish the tasks:

The script should be placed in the /scripts directory on App Server 3.

```
bash
#!/bin/bash

# Create a zip archive of /var/www/html/official directory

zip -r /backup/xfusioncorp_beta.zip /var/www/html/official

# Copy the created archive to Nautilus Backup Server in /backup/ location
# Make sure to setup passwordless SSH login for the respective server user

scp /backup/xfusioncorp_beta.zip <username>@<Nautilus_Backup_Server_IP>:/backup/

```


Here's a breakdown of the tasks and how they're accomplished:

a. *Create a zip archive of /var/www/html/official directory:*
- zip -r /backup/xfusioncorp_official.zip /var/www/html/official

b. *Save the archive in /backup/ on App Server 3:*
- The zip command above saves the archive in /backup/.

c. *Copy the created archive to Nautilus Backup Server in /backup/ location:*

- scp /backup/xfusioncorp_official.zip <username>@<Nautilus_Backup_Server_IP>:/backup/
- Replace <username> with the username on Nautilus Backup Server and <Nautilus_Backup_Server_IP> with the IP address of Nautilus Backup Server.

d. Make sure the script won't ask for password while copying:
- To achieve this, you need to setup passwordless SSH login between App Server 3 and Nautilus Backup Server for the respective server user.
- You can do this by generating an SSH key pair on App Server 3 for the user who will run the script, and then copying the public key to Nautilus Backup Server's authorized_keys file.

To setup passwordless SSH:

1. On App Server 3, run ```ssh-keygen -t rsa``` to generate an SSH key pair. Leave the passphrase empty.
2. Copy the public key to Nautilus Backup Server using the following command :

```
 ssh-copy-id <username>@<Nautilus_Backup_Server_IP>.
```

This way, the script can copy files to Nautilus Backup Server without asking for a password, and the respective server user can run the script.

Don't forget to make the script executable - Run the following command:
```
sudo chmod +x /scripts/official_backup.sh
```

Run the script: You can run the script using:
```
sudo /scripts/beta_backup.sh
```

---------------------------------------------------

**Note:**

*Before copying the archive to Nautilus Backup Server using the scp command in the script or running the beta_backup.sh script , you should setup passwordless SSH login.*

This is because the scp command will try to authenticate with Nautilus Backup Server, and if passwordless SSH isn't setup, it will prompt for a password. Since the script is meant to run without user intervention, you want to avoid password prompts.

To setup passwordless SSH login between App Server 3 and Nautilus Backup Server for the user running the script:
1. Generate an SSH key pair: On App Server 3, run ssh-keygen -t rsa for the user who'll run the script. Leave the passphrase empty.
2. Copy the public key to Nautilus Backup Server: Use ssh-copy-id <username>@<Nautilus_Backup_Server_IP> to copy the public key to Nautilus Backup Server's authorized_keys file.

Once passwordless SSH is setup, the scp command in the official_backup.sh script should copy the archive to Nautilus Backup Server without asking for a password.


-----------------------------------------------

**Note:**

**You should run the command sudo chmod +x /scripts/official_backup.sh outside of the script.**

This command is used to make the official_backup.sh script executable. You need to run this command manually in the terminal on App Server 3, after you've created and saved the script in the /scripts directory.

You don't need to include this command inside the script itself. Instead:
1. Create and save the official_backup.sh script in /scripts.
2. Run sudo chmod +x /scripts/official_backup.sh in the terminal to make the script executable.
3. Then you can run the script using sudo /scripts/official_backup.sh

Does that make sense?
